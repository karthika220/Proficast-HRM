generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Attendance {
  id                   String         @id @default(cuid())
  userId               String
  date                 DateTime
  checkIn              DateTime?
  checkOut             DateTime?
  status               String
  breakEnd             DateTime?
  breakMinutes         Float?         @default(0)
  breakStart           DateTime?
  checkInCount         Int            @default(0)
  createdAt            DateTime       @default(now())
  employeeId           String?
  isLate               Boolean        @default(false)
  lateMinutes          Float?         @default(0)
  updatedAt            DateTime
  gracePeriodUsed      Boolean        @default(false)
  breakReminderSent    Boolean        @default(false)
  breakType            String?        @default("LUNCH")
  lateNotificationSent Boolean        @default(false)
  overtimeHours        Float?         @default(0)
  totalWorkHours       Float?         @default(0)
  attendanceState      String?        @default("CHECKED_IN")
  totalBreakMinutes    Float?         @default(0)
  User                 User           @relation(fields: [userId], references: [id])
  BreakSession         BreakSession[]
}

model BreakSession {
  id           String     @id @default(cuid())
  attendanceId String
  start        DateTime
  end          DateTime?
  duration     Float?
  breakType    String?    @default("LUNCH")
  createdAt    DateTime   @default(now())
  Attendance   Attendance @relation(fields: [attendanceId], references: [id])
}

model EmployeeActivity {
  id              Int       @id @default(autoincrement())
  employeeId      String
  date            DateTime
  checkIn         DateTime?
  checkOut        DateTime?
  breakMinutes    Int       @default(0)
  workingMinutes  Int       @default(0)
  overtimeMinutes Int       @default(0)
  status          String    @default("Present")
  createdAt       DateTime  @default(now())

  @@unique([employeeId, date])
}

model Escalation {
  id           String    @id @default(cuid())
  userId       String
  type         String
  severity     String
  description  String
  status       String    @default("OPEN")
  count        Int       @default(1)
  triggeredBy  String
  triggeredAt  DateTime  @default(now())
  resolvedAt   DateTime?
  resolvedBy   String?
  notes        String?
  createdAt    DateTime  @default(now())
  updatedAt    DateTime
  absenceCount Int?      @default(0)
  emailSent    Boolean   @default(false)
  lateCount    Int?      @default(0)
  User         User      @relation(fields: [userId], references: [id])
}

model LeaveBalance {
  id          String   @id @default(cuid())
  userId      String   @unique
  casual      Int      @default(8)
  sick        Int      @default(8)
  casualUsed  Int      @default(0)
  createdAt   DateTime @default(now())
  sickUsed    Int      @default(0)
  updatedAt   DateTime
  yearJoined  Int
  lastUpdated DateTime @default(now())
  leaveYear   Int      @default(2026)
  User        User     @relation(fields: [userId], references: [id])
}

model LeaveRequest {
  id                String      @id @default(cuid())
  userId            String
  type              LeaveType
  startDate         DateTime
  endDate           DateTime
  reason            String?
  status            LeaveStatus @default(PendingManager)
  createdAt         DateTime    @default(now())
  approvedByHR      Boolean     @default(false)
  approvedByMD      Boolean     @default(false)
  approvedByManager Boolean     @default(false)
  days              Int
  updatedAt         DateTime
  approvedBy        String?
  rejectionReason   String?
  User              User        @relation(fields: [userId], references: [id])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String
  message   String
  createdAt DateTime @default(now())
  isRead    Boolean  @default(false)
  title     String
  type      String
  emailSent Boolean  @default(false)
  emailTo   String?
  User      User     @relation(fields: [userId], references: [id])
}

model User {
  id                  String           @id @default(cuid())
  employeeId          String?          @unique
  fullName            String?
  email               String           @unique
  password            String
  phone               String?
  role                Role             @default(EMPLOYEE)
  department          String?
  designation         String?
  reportingManagerId  String?
  dateOfJoining       DateTime?
  status              String           @default("Active")
  createdAt           DateTime         @default(now())
  workMode            WorkMode?        @default(ONSITE)
  currentAddress      String?
  dateOfExit          DateTime?
  gender              Gender?
  maritalStatus       MaritalStatus?
  permanentAddress    String?
  totalExperience     Float?
  createdBy           String?
  dob                 DateTime?
  profilePicture      String?
  currentCompanyName  String?
  currentYearsExp     Float?
  previousCompanyName String?
  previousYearsExp    Float?
  roleLevel           RoleLevel        @default(EMPLOYEE)
  Attendance          Attendance[]
  Escalation          Escalation[]
  LeaveBalance        LeaveBalance?
  LeaveRequest        LeaveRequest[]
  Notification        Notification[]
  User                User?            @relation("UserToUser", fields: [reportingManagerId], references: [id])
  other_User          User[]           @relation("UserToUser")
  WorkExperience      WorkExperience[]
}

model WorkExperience {
  id          String    @id @default(cuid())
  userId      String
  companyName String
  jobTitle    String
  fromDate    DateTime
  toDate      DateTime?
  createdAt   DateTime  @default(now())
  isRelevant  Boolean   @default(false)
  User        User      @relation(fields: [userId], references: [id])
}

enum Gender {
  MALE
  FEMALE
  OTHER
}

enum LeaveStatus {
  PendingManager
  PendingHR
  PendingMD
  Approved
  Rejected
}

enum LeaveType {
  CL
  SL
  UL
}

enum MaritalStatus {
  SINGLE
  MARRIED
  DIVORCED
  WIDOWED
}

enum Role {
  MD
  HR
  MANAGER
  EMPLOYEE
  TL
}

enum RoleLevel {
  MD
  HR
  MANAGER
  TL
  EMPLOYEE
}

enum WorkMode {
  REMOTE
  ONSITE
  CLIENT_OFFICE
}
